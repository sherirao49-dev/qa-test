<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI QA Tester</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; max-width: 800px; margin: 2rem auto; background-color: #f4f4f9; }
        .container { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { color: #333; text-align: center; }
        label { font-weight: bold; display: block; margin-top: 1rem; }
        input, textarea { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box;}
        button { width: 100%; padding: 12px; background-color: #007bff; color: white; border: none; border-radius: 6px; font-size: 16px; margin-top: 20px; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        #logs { margin-top: 20px; padding: 15px; background: #222; color: #0f0; font-family: monospace; border-radius: 6px; white-space: pre-wrap; display: none; }
        .loading { text-align: center; margin-top: 10px; display: none; color: #666; }
    </style>
</head>
<body>

    <div class="container">
        <h1>ü§ñ Automated QA Tester</h1>
        <p style="text-align:center; color:#666;">Enter a website and task. The AI will write and run a test script.</p>

        <label>üîë Gemini API Key</label>
        <input type="password" id="apiKey" placeholder="Paste your AI Studio Key here...">

        <label>üåê Website URL</label>
        <input type="text" id="url" value="https://www.daraz.pk/">

        <label>üìã Test Instruction</label>
        <textarea id="instruction" rows="4">Search for 'iPhone 15 covers', click the first result, and verify if 'Add to Cart' button is visible.</textarea>

        <button onclick="runTest()">üöÄ Run QA Test</button>
        
        <div class="loading" id="loading">
            ‚öôÔ∏è AI is generating script and running browser... please wait...
        </div>

        <div id="logs"></div>
    </div>

    <script>
        async function runTest() {
            const apiKey = document.getElementById('apiKey').value;
            const url = document.getElementById('url').value;
            const instruction = document.getElementById('instruction').value;
            const logsDiv = document.getElementById('logs');
            const loadingDiv = document.getElementById('loading');

            if(!apiKey) { alert("Please enter your API Key!"); return; }

            // Show loading state
            loadingDiv.style.display = 'block';
            logsDiv.style.display = 'none';
            logsDiv.textContent = "";

            try {
                const response = await fetch('/api/run-test', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey, url, instruction })
                });

                const data = await response.json();
                
                loadingDiv.style.display = 'none';
                logsDiv.style.display = 'block';

                if(data.error) {
                    logsDiv.style.color = 'red';
                    logsDiv.textContent = "‚ùå ERROR: \n" + data.error;
                } else {
                    logsDiv.style.color = '#0f0';
                    logsDiv.textContent = "‚úÖ TEST EXECUTION LOGS:\n\n" + data.output;
                    
                    // Show the Generated Code (Optional, for transparency)
                    logsDiv.textContent += "\n\n-------------------\nüìú GENERATED SCRIPT:\n" + data.generatedCode;
                }

            } catch (err) {
                loadingDiv.style.display = 'none';
                alert("Network Error: " + err.message);
            }
        }
    </script>

</body>
</html>